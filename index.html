<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VacState</title>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      margin-bottom: 5px;
    }
    #counts {
      margin-bottom: 15px;
      font-size: 1rem;
      color: #555;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px 10px;
      text-align: left;
      font-size: 0.9rem;
    }
    th {
      background-color: #f2f2f2;
    }
    tbody tr:nth-child(even) {
      background-color: #fafafa;
    }
  </style>
</head>
<body>
  <h1>VacState</h1>
  <div id="counts">Loading data...</div>
  <table id="data-table">
    <!-- Table header and body will be populated by D3 -->
  </table>

  <script>
    // Replace $limit value if your dataset has more than 50,000 rows.
    const endpoint = 'https://data.cdc.gov/resource/ee48-w5t6.json?$limit=50000';

    d3.json(endpoint).then(function(data) {
      // If there is no data, show a message and return
      if (!data || data.length === 0) {
        d3.select('#counts').text('No data returned from the API.');
        return;
      }

      // Determine column names from the first object’s keys
      const columns = Object.keys(data[0]);

      // Update the counts header
      const rowCount = data.length;
      const colCount = columns.length;
      d3.select('#counts')
        .text(`Rows: ${rowCount} | Columns: ${colCount}`);

      // Select the table element
      const table = d3.select('#data-table');

      // Append the header row
      const thead = table.append('thead');
      thead.append('tr')
        .selectAll('th')
        .data(columns)
        .enter()
        .append('th')
        .text(d => d);

      // Append the body rows
      const tbody = table.append('tbody');
      const rows = tbody.selectAll('tr')
        .data(data)
        .enter()
        .append('tr');

      // For each row, append a cell for every column
      rows.selectAll('td')
        .data(function(row) {
          return columns.map(function(col) {
            // Some records might not have every field; fallback to empty string
            return { value: row[col] || '' };
          });
        })
        .enter()
        .append('td')
        .text(d => d.value);
    }).catch(function(error) {
      console.error('Error fetching data:', error);
      d3.select('#counts').text('Error fetching data from the API.');
    });
  </script>
</body>
</html>
